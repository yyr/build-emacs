#!/bin/bash
#
# Copyright (C) Yagnesh Raghava Yakkala. http://yagnesh.org
#    File: buildemacs.sh
# Created: Tuesday, March 22 2011
# Licence: GPL v3 or later
#

MIRROR="git://repo.or.cz/emacs.git"
SCRIPT_DIR=$(cd `dirname $BASH_SOURCE`; pwd)
cd $SCRIPT_DIR

. ./be-functions

install_dir=$HOME/local/emacs-git
backup_dir=$HOME/local/emacs-backup

cd $repo_dir
run_git                      # may be update to latest trunk

case `hostname` in
    amur*)
        conf_flags=' --with-jpeg=no --with-gif=no --with-tiff=no --without-gnutls'
        ;;
    *)
        conf_flags=" --with-gnutls=yes   --without-compress-info"

esac

# by default try to run make normally if there is no
# configure script then run "make bootstrap"
bootstrap="no"

if [ ! -f configure ]; then
    run_autogen
    bootstrap=yes
    run_configure
fi

run_make

# back up earlier installation
if [ -d $install_dir ]; then
    if [ -d $backup_dir ]; then
        rm -r $backup_dir
    fi
    mv $install_dir  ${backup_dir}
fi

announce "make install"
make install &> install.log || error_convay "while running 'make install' check install.log"
announce "built emacs successfully"

# buildemacs ends here
